# 🐻같이 고민해요, 곰곰

혼자 선택하기 어려운 고민, 익명으로 나누고 싶은 고민이 있다면 ‘곰곰’에서 함께 고민해드립니다!<br><br>
<img width="1080" src="https://user-images.githubusercontent.com/107025988/193507282-9ab12908-9fca-4e38-9214-03b2e73da287.png">

## 👉 [곰곰 둘러보기](https://www.gomgom.site)

<br>

### 👉 [곰곰 노션](https://www.notion.so/c8bbb8119d4a46e996c2806e41e2be4c)

---

<br>

# 🎆 프로젝트 소개

<br>

### 💻 Front-end

[GitHub](https://github.com/E-01-noWorry/Frontend)
<br>

### 💻 Back-end

[GitHub](https://github.com/E-01-noWorry/Backend)
<br><br>

---

<br>

### 곰곰 주요 기능

- **회원가입 및 로그인 🤝** <br>

  - 일반 로그인 및 카카오/구글 로그인을 통해 간편한 로그인 가능
  - 닉네임 설정을 통해 익명으로 대화 가능

- **고민 투표 📑✏️✅**<br>

  - 선택의 어려움을 겪고 있는 고민에 대한 투표글을 작성하여 다른 유저의 의견 확인
  - 2~4개의 선택지를 작성할 수 있고, 선택적으로 이미지 첨부 가능
  - 투표 종료 시간을 설정하고, 설정한 시간만큼 투표를 받을 수 있음
  - 투표 및 댓글/대댓글을 통해 간단한 소통 가능
  - 고민 제목 및 선택지 내용 검색으로 투표글 조회 가능
  - 인기순 / 진행중인 투표/ 카테고리 별로 투표글을 필터링 조회 가능
  - 투표글 작성 시 3점 / 투표 참여 1회당 1점 / 글 마감시 최다 투표 결과와 본인 투표가 일치할 시 5점의 포인트 획득

- **고민 상담 💬**<br>
  - 익명으로 실시간 소통하며 고민에 대한 다른 유저의 의견 확인
  - 상담방 제목 및 해시태그 내용 검색으로 상담방 조회 가능
  - 상담방 목록에서 자신이 참여중인 상담방 확인 가능
  - 비매너 유저를 내보낼 수 있는 강퇴 기능(강퇴 당한 유저는 재입장 불가능)
  - 고민해결에 도움을 준 유저 추천 기능
  - 상담방 생성 시 3점 / 상담방 방장의 추천을 받을 시 5점의 포인트 획득
- **곰곰해답 📖**<br>
  - 고민 및 선택에 대한 간단한 해답을 곰곰이가 유저에게 전달
- **마이페이지 👤 📖**<br>
  - 서비스를 사용하며 누적된 포인트 확인 및 등급별 프로필 확인 가능
  - 내가 작성한 고민 투표 및 고민 상담방 / 내가 참여한 고민 투표 및 고민 상담방 조회 가능
  - 곰곰 개발자들에게 문의 및 건의사항을 보낼 수 있는 1:1 문의 기능
  - 닉네임 변경 기능으로 익명성 보장
  - 개인 정보 삭제가 가능한 회원 탈퇴 기능
- **푸시알림 🔔**<br>
  - 웹, 안드로이드 환경 알림허용 후 백그라운드 환경일때 푸시알림 전송(ios 지원 불가)
  - 댓글, 대댓글 생성시 푸시알림
  - 고민투표글 누적 투표 3배수 시 푸시알림
  - 내가 만든 상담방 새로운 채팅시 푸시알림

<br>

---

<br>

### 🎬 기능 구현 영상

<br>

#### 👉 [보러가기](https://youtu.be/2BKY5G8FlQg)

<br>

---

<br>

## 🧰Back-end 기술 Tools 소개

<img src="https://img.shields.io/badge/Node.js-339933?style=flat-square&logo=node.js&logoColor=white" width="10%" height="10%"/>&nbsp; <img src="https://img.shields.io/badge/Express-000000?style=flat-square&logo=express&logoColor=white" width="10%" height="10%"/>&nbsp; <img src="https://img.shields.io/badge/javascript-333333?style=flat-square&logo=javascript&logoColor=yellow" width="12%" height="12%"/>&nbsp; <img src="https://img.shields.io/badge/npm-CB3837?style=flat-square&logo=npm&logoColor=white" width="8%" height="8%"/>&nbsp; <img src="https://img.shields.io/badge/Let's Encrypt-003A70?style=flat-square&logo=Let's Encrypt&logoColor=white" width="14%" height="14%"/>&nbsp; <img src="https://img.shields.io/badge/PM2-2B037A?style=flat-square&logo=PM2&logoColor=white" width="8%" height="8%"/><br><br>

<img src="https://img.shields.io/badge/Amazon AWS-232F3E?style=flat-square&logo=Amazon AWS&logoColor=white" width="15%" height="15%"/>&nbsp; <img src="https://img.shields.io/badge/Amazon EC2-FF9900?style=flat-square&logo=Amazon EC2&logoColor=white" width="13%" height="13%"/>&nbsp; <img src="https://img.shields.io/badge/Amazon S3-569A31?style=flat-square&logo=Amazon S3&logoColor=white" width="13%" height="13%"/>&nbsp; <img src="https://img.shields.io/badge/MySQL-4479A1?style=flat-square&logo=MySQL&logoColor=white" width="10%" height="10%"/>&nbsp; <img src="https://img.shields.io/badge/Sequelize-A9A9F5?style=flat-square&logo=Sequelize&logoColor=black" width="12%" height="12%"/><br><br>

<img src="https://img.shields.io/badge/github-181717?style=flat-square&logo=github&logoColor=white" width="10%" height="10%"/>&nbsp; <img src="https://img.shields.io/badge/github actions-A9D0F5?style=flat-square&logo=github actions&logoColor=black" width="16%" height="16%"/>&nbsp; <img src="https://img.shields.io/badge/Passport-81F79F?style=flat-square&logo=Passport&logoColor=black" width="11%" height="11%"/>&nbsp; <img src="https://img.shields.io/badge/JSON Web Tokens-000000?style=flat-square&logo=JSON Web Tokens&logoColor=white" width="19%" height="19%"/>&nbsp; <img src="https://img.shields.io/badge/FCM-FFCA28?style=flat-square&logo=firebase&logoColor=black" width="8%" height="8%"/>&nbsp; <img src="https://img.shields.io/badge/Socket.io-010101?style=flat-square&logo=Socket.io&logoColor=white" width="12%" height="12%"/>

<br>

---

<br>

## ⚙️ Architecture

<br>

![아키텍쳐](https://user-images.githubusercontent.com/107025988/193801322-f95faa04-f107-4354-9df0-0453ce9ea166.png)

<br>

---

<br>

## 🔧 기술적 의사결정

| 사용 기술                           | 기술 결정 이유                                                                                                                                                                                                                                                                                                                                 |
| ----------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `MySQL`                             | mongoDB vs MySQL<br><br> mongoDB보다 상대적으로 익숙한 MySQL을 이용하는 것이 원활한 프로젝트 진행이 될 것 같다고 판단했고, 선택글-투표-댓글 / 채팅방-참가자-채팅 등 데이터들 간의 관계성이 중요하여 관계형 DBMS를 사용했습니다.                                                                                                                |
| `socket.io`                         | socket.io vs WebSocket<br><br>socket.io는 room 개념을 이용해 각각의 채팅방을 개설하여 방에 입장한 유저들끼리 통신을 주고 받을 수 있도록 https를 이용한 실시간 데이터 통신이 가능한 socket.io 사용을 결정했습니다                                                                                                                               |
| `dayjs`                             | dayjs vs new Date() vs moment<br><br>시간을 사용하는 기능을 new Date()로 구현했지만, 배포 EC2의 타임존이 다른 문제로 시간설정을 현재 한국시간으로 맞추는데 애로사항이 있었습니다. 이에 dayjs와 moment 라이브러리 중 지속적인 업데이트를 지원하고, 좀더 가볍고 사용법이 쉬운 dayjs를 선택하여 한국으로 타임존을 맞추고 현재시간을 설정했습니다. |
| `node-schedule`                     | node-schedule vs node-cron<br><br>schedule과 cron 차이는 크게 없지만, 복잡한 시간설정이 가능한 schedule를 이용하여 설정한 투표 종료시간이 되면 자동으로 db에 접근하여 값을 수정하도록 했습니다. 또한, 서버 재시작시 schedule 큐에 쌓인 스택이 초기화되는 것을 해결하기 위해 schedule를 이용해 주기적으로 db에 접근할 수 있도록 했습니다.       |
| `FCM`                               | 자신의 선택글, 상담방 등에 다른 유저의 상호작용 발생 시 실시간 푸시알림을 보내주어 활발한 사이트 이용을 유도했습니다.                                                                                                                                                                                                                          |
| `PWA`                               | 웹앱 설치를 유도하여 재사용성 증가, 백그라운드 푸시 알림 등을 구현하기 위해 도입하였습니다.                                                                                                                                                                                                                                                    |
| `Redux toolkit`                     | Redux Toolkit vs Recoil<br><br>전역 상태를 효율적으로 관리 하기 위해 라이브러리를 도입하였습니다.<br>사용자가 많아 오픈소스 양이 많은 redux로 채택했습니다.<br>그 중에서도 redux 패키지 설치가 용이하고, 보일러 플레이트가 훨씬 줄어든 redux-toolkit으로 결정했습니다.                                                                         |
| `Axios`                             | Axios vs JS Fetch API<br><br>response timeout (fetch에는 없는 기능) 처리 방법이 존재<br>Promise 기반으로 만들어졌기 때문에 데이터를 다루기 편리합니다.<br>브라우저 호환이 fetch보다 뛰어나기 때문에 웹 앱을 염두한 곰곰 서비스에 적합하다고 생각했습니다.                                                                                      |
| `Styled components`                 | CSS-in-JS vs CSS-in-CSS<br><br>css를 파일 분리 없이 유지 보수 할 수 있는점이 장점이라 생각했습니다.<br>props나 state에 따른 동적 스타일링이 가능합니다.<br>그 중 점유율이 높은 styled components를 사용하기로 결정했습니다.                                                                                                                    |
| `S3`<br>`Cloud Front`<br>`Route 53` | vs Vercel<br><br>배포가 간편한 vercel을 사용할까 고민했지만, aws의 배포 플랫폼들을 경험해보고 싶었습니다.                                                                                                                                                                                                                                      |
| `Github actions`                    | 프론트엔드와 백엔드의 효율적인 협업을 위해, 자동배포를 진행하였습니다.                                                                                                                                                                                                                                                                         |

<br>

---

<br>

## 🔥트러블슈팅

<br>

<details>
<summary> S3/Multer </summary>
<br>

❓ 문제

- 이미지 파일 업로드를 어디에서 처리해야 좋은지 고민이 있었음
  - 프론트에서 S3 업로드 시 서버 DB에 URL 저장 후 사용하여 트래픽 부하를 줄일 수 있어 효율적이지만, S3 시크릿키 유출의 위험성이 존재함
  - 서버에서 S3 업로드 시 트래픽 증가 문제는 있었지만, 보안 문제를 미연에 방지할 수 있다는 장점이 있음

❗️ 해결

- 파일 업로드를 프론트에서 처리 하는 것이 더 효율적이지만, 한번에 업로드하는 이미지 파일이 많지 않았고, 보안 문제는 미연에 방지하는 것이 더 중요하다고 판단하여 서버에서 S3 업로드 처리를 하기로 결정함
- 트래픽 부하를 줄이기 위해 프론트에서 파일 크기를 리사이징 하고 서버로 넘겨 트래픽을 줄이고, 이미지 파일의 용량을 제한하는 방향으로 진행함.<br><br>
</details>
<br>
<details>
<summary> 고민투표글 시간 종료시 마감처리 </summary>
<br>

❓ 문제

- 글 작성시 종료시간을 저장하여 해당 시간이 되면 마감처리를 하여 마감된 글로 표시하고, 투표를 더이상 받지 않게 변화 시켜줘야 했음
  - 처음엔 api 응답시 현재시간과 종료시간을 비교하여 마감여부를 true, false로 전달
    - But, 마감후 투표 포인트 적립을 할 수 없는 문제 발생
- DB에서 특정시간이 되면 값을 바꾸는 방법 혹은, 특정 시간이 되면 api요청 없이 서버에서 특정 함수를 실행하는 방법을 구글링 함

❗️ 해결

- 구글링과 기술 멘토님의 조언으로 node-schedule을 알게 되어 적용
  - 종료시간이 되면 DB에 접근하여 데이터 값을 false에서 true 바꾸고, 투표 포인트를 적립하는 로직을 구현하여 자동으로 마감처리를 진행
- 그러나 서버 재시작시 schedule 큐에 쌓인 스택이 초기화 되어 마감처리가 불가능한 문제 발생

  - 서버 재시작시 스택 초기화를 대비하여 주기적으로 DB에 접근하여 마감처리가 안된 글의 데이터를 변경하는 로직을 구현하여 데이터 최신화 문제를 해결함

- 위 과정에서 현재 한국시간에 딱 맞춰서 함수가 실행되지 않는 문제가 발생
  - 배포된 EC2의 타임존이 한국과 9시간 차이나는 환경이라, 단순히 9시간을 더해줬지만 문제가 해결되지 않음
  - 결국 기존의 new Date() 함수를 dayjs로 모두 바꾸고, <br>배포환경도 dayjs.tz.setDefault('Asia/Seoul')로 한국 타임존을 설정하여 문제를 해결함<br><br>
  </details>
  <br>
  <details>
  <summary> 카카오 소셜로그인 </summary>
  <br>

❓ 문제

- 서버에서 보내는 카카오 로그인 정보가 프론트에서 보여지긴 하지만, 데이터에 접근할 수 없는 문제가 발생함
- 프론트에서 redirect_uri를 서버 쪽으로 맞추면 프론트에서 데이터에 접근이 되지 않았고, 프론트 로컬 서버로 맞추면 redirect_uri mis match 에러가 발생함

❗️ 해결

- Kakao Developers의 문서를 읽어보면서 문제를 해결하려 했으나 이해하기가 어려워 CORS, KOE에러 (특히 006, redirect관련 오류) 등을 Kakao Developers 포럼에 문의를 하여 답변을 받고, 포럼 내 게시글 검색을 통하여 여러 자료들을 참고함
- redirect_uri mismatch는 카카오로그인 애플리케이션에 redirect_uri를 추가하고, 프론트와 서버의 redirect_uri를 합치시켜서 해결하였음
  ![](https://user-images.githubusercontent.com/107025988/193506725-96668b13-3f76-42c1-850c-d17a24337e8a.png)
- 서버에서 .env에 작성해두었던 callback_url을 프론트 서버로 수정하였고, 프론트에서도 데이터를 받아온 후 메인페이지로 이동하도록 코드를 작성하고, 로그인 데이터를 받아오는 코드도 수정하였습니다.
- 서버에서는 callback_url을 서버 쪽으로 작성하고 있었기 때문에 프론트에서 데이터 접근이 불가능했었고, 프론트에서는 window.location.replace(’/’) 코드가 중복되어 무한 로딩에 걸리는 문제를 확인하여 해결하였습니다.
</details>
<br>
<details>
<summary> 자동 로그인 연장 / 로그인 유무 판단 문제 </summary>
<br>

❓ 문제

- 만료된 토큰이 로컬스토리지에 계속 남아있는 문제
- 액세스 토큰이 만료됐음에도 사용자가 글을 등록하거나 댓글을 쓰기 전까지 로그인이 만료 된 사실을 알 수 없는 문제
- 로컬스토리지의 액세스 토큰 유무로 로그인/비로그인을 판단하는데 심각한 오류가 발생

- 리프레시 토큰이 유효하다면 알아서 액세스 토큰을 계속 재발급 해줄 필요성을 느낌
- 그리고 둘 다 만료가 됐다면 로컬스토리지를 자동으로 비워 유저를 비로그인 상태로 만들어야함

❗️ 해결

- 리프레시 토큰이 유효하다면 자동으로 새로운 액세스 토큰 발급받기
  - 클라이언트에서 서버로 API요청할때 헤더에 들어있는 액세스 토큰 값이 만료가 됐다면, 재발급이 필요하다는 메세지와 함께 새로운 액세스 토큰 값을 응답 값으로 전달
  - 클라이언트에서는 axios Interceptors로 새로 받은 액세스 토큰 값을 사용하여 재요청을 보내는 로직을 구현함
  - 이렇게 하면 유저가 로그인이 만료 됐다는 정보를 알 필요 없이 유효한 토큰 값으로 알아서 재요청을 할 수 있게 됨
- 리프레시 토큰, 액세스 토큰이 모두 만료됐다면 로컬스토리지 값 비우기
  - 토큰이 모두 만료됐다면 서버에서 401에러와 함께 만료 메시지를 보냄
  - 그럴 경우에 interceptors로 로컬스토리지 값을 비워주는 로직을 구현함
  </details>

<br>

---

<br>

### 📝유저 피드백

<details>
<summary> ✒️유저 테스트 피드백(10.03 기준)✒️ </summary>
<br>

- 사용자 피드백 응답 106개<br>
- 신규 회원 약 230명<br>
- 생성된 게시물 약 70개<br>
- 참여한 투표 수 약 600개<br>
- 작성한 댓글/대댓글 약 170개<br>
- 생성된 채팅방 약 20개<br>
- 채팅방 참가 약 230명<br>
- 주고받은 채팅 630개
</details>

<br>

<details>
<summary>  ⛳유저 피드백 반영⛳ </summary>
<br>
 
  - UI 개선
    - 고민투표글 검색 및 진행중인 투표 필터 기능 추가
    - 상담방 UI 대폭 수정(상담방 입장모달 추가, 참여중인 상담방 목록에서 확인 가능, 현재 상담방 참여한 인원 확인 가능 등)
    - 최상단 이동 버튼 추가
  - 채팅방 강퇴기능 추가(강퇴시 재입장 불가능)
  - 카카오 소셜로그인 시 닉네임 설정 화면으로 이동 추가
  - 회원 탈퇴기능 추가

</details>
<br>

#### 설문 링크 : https://forms.gle/MANwTgdAr3H2UC2s5

<br>

---

<br>

## 👥 팀원소개

| 역할   | 이름   | github                                   |
| ------ | ------ | ---------------------------------------- |
| BE🔰   | 시진엽 | [GitHub](https://github.com/Edward-SI03) |
| BE     | 김대린 | [GitHub](https://github.com/kimdaerin)   |
| BE     | 조은지 | [GitHub](https://github.com/JJooonji)    |
| FE🔰   | 김영진 | [GitHub](https://github.com/devyouth94)  |
| FE     | 김윤철 | [GitHub](https://github.com/Aaron-Kim33) |
| Design | 김민수 | 디자인 담당                              |

<br>
